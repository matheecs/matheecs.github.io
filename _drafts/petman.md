# Petman

PetProto and Petman walk using a **hybrid hierarchical control architecture**. This hybrid control consists of discrete and continuous components. The **discrete component** is primarily responsible for **control of balance using foot placement**, and thus has a dominant influence on the robot's forward and lateral motion. The **continuous component** is responsible for **control of body height and orientation**, and can also influence balance by modifying the forces exerted by the stance leg, including actively moving the center-of-pressure (CoP) of the feet.

Legs that are in **swing** are handled by the **discrete part** of the hybrid control, which consists of two core pieces: a tep-by-step **balance controller** and a **hierarchical swing controller**.

* The **balance controller** uses foot placement to control the forward and lateral motion of the robot, and builds on the balance control used by **BigDog**. The essence of our implementation is to monitor the location of the instantaneous **capture point** using intelligent estimation of body state. The controller then calculates where to place the swing foot relative to the capture point in order to balance the robot as well as achieve desired body motion. This placement location also considers the mechanics of how the foot will interact with the ground, which can differ sagittally and laterally. The desired body motion includes nominal desired forward and lateral velocities, as well as a lateral body oscillation that will achieve proper foot separation.
* The **hierarchical swing controller** is responsible for planning a trajectory for the swing leg, **relative to the body**, that will place the swing foot at the desired touchdown location specified by the balance controller. Local position controllers on the swing leg joints then follow desired joint motion specified by inverse kinematics, taking into account practical constraints such as joint limits and avoiding collisions with the stance leg.

Legs that are in **stance** are controlled by the **continuous part** of the hybrid control. This is a **hierarchical structure** that starts with **high-level posture control** of the body.

* The **posture control** is responsible for regulating the height and orientation of the body. It is also responsible for following desired upper body trajectories, such as desired pelvis, back, and arm motion. The posture control uses a virtual servo on the body to **generate virtual forces** that correct deviations from the desired body posture and motion.
* A **force distribution algorithm** then decides how to best realize these virtual forces using the stance leg, given the available support footprint.
* Finally, **low-level force control** on the stance leg, with redundancy management, generates the desired foot forces specified by the higher-level algorithms.

Using these controllers, Petman is able to walk at speeds up to 4.8 [km/h] (3 [mph]). The control architecture allows for **goal data** (from motion capture of human walking) to influence the motion of the robot, especially with the upper body or where kinematic redundancy is present. Using such goal data during walking, Petman can mimic human upper-body motion in the back, shoulders, and arms. This upper-body motion also plays an important control role in counter-acting inertial reactions due to leg swing accelerations. This makes the overall, whole-body motion during the gait look more natural. Also, like PetProto, Petman is able to walk with different types of footwear and with the hydraulic tether attached just above the right ankle.
