---
layout: post
title: "ROS导航包总结"
categories: study
author: "Jixiang Zhang"
---

`nav_core` 定义了整个导航框架，并提供 3 个接口：

- nav_core::BaseGlobalPlanner
  - 开源包：global_planner、navfn、carrot_planner
  - initialize (std::string name, costmap_2d::Costmap2DROS *costmap_ros)=0
  - makePlan (const geometry_msgs::PoseStamped &start, const geometry_msgs::PoseStamped &goal, std::vector< geometry_msgs::PoseStamped > &plan)=0
  - makePlan (const geometry_msgs::PoseStamped &start, const geometry_msgs::PoseStamped &goal, std::vector< geometry_msgs::PoseStamped > &plan, double &cost)
- nav_core::BaseLocalPlanner
  - 开源包：base_local_planner、dwa_local_planner、eband_local_planner、teb_local_planner、mpc_local_planner
  - initialize (std::string name, tf2_ros::Buffer *tf, costmap_2d::Costmap2DROS *costmap_ros)=0

  1. 创建 Node Handle
  2. 加载参数
  3. 障碍物容器
  4. 创建可视化对象
  5. 加载 footprint
  6. 创建局部规划对象
  7. 初始化 tf、costmap、坐标系
  8. 设置 odom 话题获得速度
  9. 验证 footprint 的有效性
  10. 订阅话题

  - computeVelocityCommands (geometry_msgs::Twist &cmd_vel)=0

  1. 确认是否已初始化
  2. 获取机器人位姿
  3. 获取机器人速度
  4. 裁剪全局路径
  5. 转换全局路径
  6. 从全局路径中提取航迹点
  7. 检查是否到达
  8. 检查是否振荡、恢复模式
  9. 获取当前目标
  10. 起始点处理
  11. 清除后更新障碍物
  12. 执行局部路径规划
      1.  初始化 TEB 轨迹
      2.  optimizeTEB（图优化）
          1.  构建
              1.  添加顶点：Pose + TimeDiff
              2.  添加边（约束）：障碍物、航迹点、速度、加速度、时间最优、路径最短
          2.  优化
          3.  清理
  13. 失败则重新初始化
  14. 检查轨迹前几个姿态的有效性（不发生碰撞）
  15. 计算速度指令
  16. 速度限幅处理
  17. 发布可视化数据：障碍物、航迹点、全局路径

  - isGoalReached ()=0
  - setPlan (const std::vector< geometry_msgs::PoseStamped > &plan)=0
- nav_core::RecoveryBehavior
  - 开源包：clear_costmap_recovery、rotate_recovery
  - initialize (std::string name, tf2_ros::Buffer *tf, costmap_2d::Costmap2DROS *global_costmap, costmap_2d::Costmap2DROS *local_costmap)=0
  - runBehavior ()=0



`move_base` 协调感知、定位、目标信息，输出控制指令。