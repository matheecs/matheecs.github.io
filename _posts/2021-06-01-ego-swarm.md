---
layout: post
title: "EGO-Swarm 算法总结"
categories: study
author: "Jixiang Zhang"
---

```
  ┌────────────────┐                                        ▬
  │ reboundReplan  │    .─────────.                     ▬▬▬▬▬
▬ └────────────────┘ ,─'███████████'─.                ▬▬▬
  ▬▬                ╱█████████████████╲             ▬▬
     ▬ ▬ ▬         ╱███████████████████╲        ▬▬▬▬
           ▬  ▬  ▬▬█▬▬██████████████████:    ▬ ▬▬
            ●●    :███▬▬█▬█▬██▬▬█▬▬▬▬█▬▬▬▬▬▬▬    ●
             ●     :███████████████████;        ●●
              ●●   :███████████████████;       ●●
               ●●   `.███████████████,'       ●●
                ●●    '─.█████████,─'       ●●●
                 ●●●     `───────'      ●●●●●
                   ●●●●●●●●      ●●●●●●●●
                           ●●●●●●
```

算法清单

- ego_planner 调度算法
- path_searching 前端路径搜索
- bspline_opt 后端轨迹优化
- plan_env 局部地图算法
- drone_detect 点云目标检测
- rosmsg_tcp_bridge 分布式通信
- traj_utils 轨迹表示

编译设置

```cmake
set(CMAKE_BUILD_TYPE "Release")
set(CMAKE_CXX_FLAGS "-std=c++11")
set(CMAKE_CXX_FLAGS_RELEASE "-O3 -Wall -g")
```

编程规范

- ROS 包模块化
- typedef unique_ptr<BsplineOptimizer> Ptr;
- typedef std::shared_ptr<AStar> Ptr;

ROS 用法

- roslaunch XML
- message_filters

初始化

- EGOReplanFSM::init
  - EGOPlannerManager::initPlanModules
    - GridMap::initMap
    - BsplineOptimizer::setParam
    - BsplineOptimizer::setEnvironment
    - AStar::initGridMap
  - EGOPlannerManager::deliverTrajToOptimizer
  - EGOPlannerManager::setDroneIdtoOpt
  - createTimer(100Hz) -> execFSMCallback
    - planFromGlobalTraj
      - callReboundReplan
        - EGOPlannerManager::reboundReplan
          - /*** STEP 1: INIT ***/
            - PolynomialTraj::minSnapTraj
          - /*** STEP 2: OPTIMIZE ***/
            - BsplineOptimizer::BsplineOptimizeTrajRebound
          - /*** STEP 3: REFINE(RE-ALLOCATE TIME) IF NECESSARY ***/
            - EGOPlannerManager::refineTrajAlgo
              - BsplineOptimizer::BsplineOptimizeTrajRefine
    - planFromCurrentTraj
      - callReboundReplan
        - EGOPlannerManager::reboundReplan
    - planNextWaypoint
      - EGOPlannerManager::planGlobalTraj
        - PolynomialTraj::minSnapTraj/PolynomialTraj::one_segment_traj_gen
  - createTimer( 20Hz) -> checkCollisionCallback
    - planFromCurrentTraj
      - callReboundReplan
        - EGOPlannerManager::reboundReplan

状态机

```txt
                  ┌──────────────────────────────────────────────────┐
                  │                                                  │
                  ▼                   ┌───────────┐                  │
┌─────┐    ┌────────────┐             │           │                  │
│INIT │───▶│WAIT_TARGET │─┐           ▼           │                  │
└─────┘    └────────────┘ │  ┌─────────────────┐  │   ┌───────────┐  │
                          └─▶│SEQUENTIAL_START │──┴──▶│ EXEC_TRAJ │──┤
                             └─────────────────┘      └───────────┘  │
                                                            ▲        │
                                                            │        │
┌──────────────┐             ┌──────────────┐               │        │
│EMERGENCY_STOP│────────────▶│ GEN_NEW_TRAJ │──┬────────────┤        │
└──────────────┘             └──────────────┘  │            │        │
                                     ▲         │            │        │
                                     │         │            │        │
                                     └─────────┘            │        │
                                                            │        │
                                     ┌─────────┐            │        │
                                     │         │            │        │
                                     ▼         │            │        │
                             ┌──────────────┐  │            │        │
                             │ REPLAN_TRAJ  │──┴────────────┘        │
                             └──────────────┘                        │
                                     ▲                               │
                                     │                               │
                                     └───────────────────────────────┘
```